{
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "telegram_user"
            },
            {
              "name": "chatInput"
            },
            {
              "name": "actual_screen"
            }
          ]
        }
      },
      "id": "977eee16-7d5e-485d-b279-e9be63ba2c11",
      "typeVersion": 1.1,
      "name": "Start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        208,
        832
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Start').item.json.telegram_user }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1488,
        1056
      ],
      "id": "70b0d8a1-2c7a-4409-ac1f-9673693674a9",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b8d547ae-1d75-4885-ae8f-9c8d1ba18ef1",
              "name": "output",
              "value": "={{ $json.output.parseJson() }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1696,
        832
      ],
      "id": "6daa7967-e115-4925-9f24-706699c80512",
      "name": "Edit Fields2",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const raw = items[0].json.output;\n\nif (!raw) {\n  return { json: { error: \"No output received\" } };\n}\n\nif (typeof raw === 'object' && raw !== null) {\n    return {\n        json: {\n            output: raw\n        }\n    };\n}\n\nlet braceCount = 0;\nlet startIndex = raw.indexOf('{');\nlet endIndex = -1;\n\nif (startIndex === -1) {\n   return { json: { error: \"No JSON found\" } };\n}\n\nfor (let i = startIndex; i < raw.length; i++) {\n    if (raw[i] === '{') {\n        braceCount++;\n    } else if (raw[i] === '}') {\n        braceCount--;\n\n        if (braceCount === 0) {\n            endIndex = i;\n            break; \n        }\n    }\n}\n\nif (endIndex !== -1) {\n    const cleanJsonString = raw.substring(startIndex, endIndex + 1);\n    try {\n        const parsedObject = JSON.parse(cleanJsonString);\n        return {\n            json: {\n                output: parsedObject\n            }\n        };\n    } catch (e) {\n        throw new Error(\"Error parseando el JSON limpio: \" + e.message);\n    }\n} else {\n    throw new Error(\"No se pudo encontrar un objeto JSON completo en la respuesta.\");\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1920,
        832
      ],
      "id": "621a933a-48cb-4e9e-80c5-1e8796ceb1f8",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U",
          "mode": "list",
          "cachedResultName": "n8n_proyecto",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1495084735,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit#gid=1495084735"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        688,
        1056
      ],
      "id": "1f89cf6b-672c-4a28-b3cc-2e5472e15fd1",
      "name": "Obtain Session Info",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "DlZYHrjKDTxHghoa",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=Eres un componente tÃ©cnico de \"Middleware\" para AgendaBot.\nTu ubicaciÃ³n es el mÃ³dulo de LISTAS.\nNO eres un asistente conversacional. NO tomes decisiones sobre el flujo.\nTu ÃšNICA funciÃ³n es ejecutar la herramienta `obtain_session_info` y formatear la salida.\n\n# INSTRUCCIONES DE EJECUCIÃ“N\n1. Llama a la herramienta `obtain_session_info` usando el ID del usuario: {{ $json.sessionId }}\n2. Toma el resultado crudo de la herramienta.\n3. CombÃ­nalo con el input actual del usuario: \"{{ $json.chatInput }}\"\n4. Genera UN SOLO objeto JSON final.\n\n# REGLAS CRÃTICAS DE SALIDA\n- **Siempre** debes usar la herramienta `obtain_session_info`.\n- NO incluyas bloques de cÃ³digo markdown (```json).\n- NO incluyas explicaciones ni texto fuera del JSON.\n- NO intentes predecir el siguiente paso del bot.\n- NO repitas la salida. Solo un JSON.\n\n# ESTRUCTURA OBLIGATORIA DEL JSON\n{\n  \"telegram_user\": \"{{ $json.sessionId }}\",\n  \"pantalla_actual\": \"LISTAS\",\n  \"paso_actual\": \"VALOR_RECUPERADO\",\n  \"datos_parciales\": \"VALOR_RECUPERADO_TAL_CUAL\",\n  \"input\": \"{{ $json.chatInput }}\"\n}\n\n# USO DE LA MEMORIA (DATOS PARCIALES)\nDebes asegurarte de que dentro del string de \"datos_parciales\" se recuperen y mantengan los siguientes campos especÃ­ficos del proceso de creaciÃ³n de listas:\n- nombre_lista (Nombre asignado en el paso 1)\n- tipo_lista (Tipo seleccionado: Compras, Dates, Viajes, Canciones)\n- items (Lista de elementos separados por comas ingresados por el usuario)\n\n# REGLA ADICIONAL\nSi la herramienta `obtain_session_info` no devuelve datos previos para este usuario, inicializa \"paso_actual\" como \"0\" y \"datos_parciales\" como un objeto vacÃ­o \"{}\"."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        496,
        832
      ],
      "id": "a6a4325b-f63c-4cf5-aea9-67022d2c643c",
      "name": "MEMORIA ADMIN"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# CONTEXTO ACTUAL (Inputs del Sistema)\n- Paso actual: {{ $json.output.paso_actual }}\n- Datos guardados hasta ahora: {{ $json.output.datos_parciales }}\n- Mensaje del usuario: {{ $json.output.input }}\n- Pantalla actual: \"LISTAS\"",
        "options": {
          "systemMessage": "=Eres el Asistente de GestiÃ³n de Listas de AgendaBot.\nTu tarea es guiar al usuario a travÃ©s de un proceso de 5 pasos para crear una lista personalizada y sus Ã­tems.\n\n# LÃ“GICA DE CANCELACIÃ“N GLOBAL\nSi el usuario escribe \"9\" o \"cancelar\":\n- AcciÃ³n: CANCELAR_PROCESO\n- Mensaje: \"Proceso terminado.\\nÂ¿QuÃ© deseas hacer ahora?\\n1. Crear otra lista\\n9. Ir al menÃº principal\"\n\n# MÃQUINA DE ESTADOS (WIZARD)\n\n## SI EL PASO ACTUAL ES \"0\" o vacio (Inicio)\n- REGLA: No proceses el mensaje del usuario. IgnÃ³ralo totalmente aunque sea un nÃºmero.\n- AcciÃ³n: AVANZAR_PASO\n- Siguiente Paso: \"1\"\n- Mensaje: \"ðŸ“‹ **Creador de Listas**\\n\\n*Paso 1 de 5*\\nIngresa el nombre de la lista que deseas crear:\\n\\n9. Volver al menÃº principal\"\n\n## SI EL PASO ACTUAL ES \"1\" (Esperando nombre)\n- Capturar el nombre de la lista en `temp_data`.\n- Siguiente Paso: \"2\".\n- Mensaje: \"*Paso 2 de 5*\\nDigita el nÃºmero del tipo de lista que deseas crear:\\n1. Compras\\n2. Dates\\n3. Viajes\\n4. Canciones\\n\\n9. Volver al menÃº principal\"\n\n## SI EL PASO ACTUAL ES \"2\" (Esperando tipo)\n- Mapear el nÃºmero al tipo correspondiente: 1=Compras, 2=Dates, 3=Viajes, 4=Canciones.\n- Guardar el tipo seleccionado en `temp_data`.\n- Siguiente Paso: \"3\".\n- Mensaje: \"*Paso 3 de 5*\\nIngresa los Ã­tems de la lista separados por una coma (,).\\n\\nEjemplo: Arroz, Lenteja, Cepillo, etc.\\n\\n9. Volver al menÃº principal\"\n\n## SI EL PASO ACTUAL ES \"3\" (Esperando items)\n- Capturar el texto de los Ã­tems en `temp_data`.\n- Siguiente Paso: \"4\".\n- Mensaje: \"ðŸ“ **Resumen de tu nueva lista:**\\n\\n- **Nombre:** {{ $json.output.temp_data.nombre_lista }}\\n- **Tipo:** {{ $json.output.temp_data.tipo_lista }}\\n- **Ãtems:** {{ $json.output.input }}\\n\\nÂ¿Confirmas los cambios?\\n1. Confirmar y guardar\\n9. Cancelar y volver al menÃº principal.\"\n\n## SI EL PASO ACTUAL ES \"4\" (ConfirmaciÃ³n Final)\n- Si \"1\": \n  - AcciÃ³n: GUARDAR. \n  - Mensaje: \"âœ… Â¡Lista creada con Ã©xito!\\n\\nÂ¿QuÃ© deseas hacer ahora?\\n1. Crear otra lista\\n9. Ir al menÃº principal\"\n- Si \"9\": Ejecutar CancelaciÃ³n Global.\n\n## SI EL PROCESO TERMINÃ“ (MenÃº Post-AcciÃ³n)\n- Si \"1\": Reiniciar Wizard (Ir a Paso 0).\n- Si \"9\": AcciÃ³n: SALIR_MENU.\n\n# FORMATO DE RESPUESTA JSON (OBLIGATORIO)\nResponde ÃšNICAMENTE con este objeto JSON:\n{\n  \"output\": \"Texto para Telegram\",\n  \"data\": {\n    \"next_step\": \"NÃºmero del siguiente paso (string)\",\n    \"temp_data\": { \n        \"nombre_lista\": \"VALOR\",\n        \"tipo_lista\": \"VALOR\",\n        \"items\": \"VALOR\"\n    },\n    \"action\": \"CONTINUAR | GUARDAR | CANCELAR_PROCESO | SALIR_MENU\",\n    \"actual_screen\": \"LISTAS\"\n  }\n}\n\n# REGLA\n- Solamente debes retornar una unica vez la respuesta en JSON.\n- Piensa detenidamente antes de generar el JSON.\n- Si el usuario ingresa un nÃºmero de tipo invÃ¡lido en el paso 2, vuelve a solicitarlo manteniendo el paso actual."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        1344,
        832
      ],
      "id": "b45977c5-e182-42cd-a4c0-baff62d08e5c",
      "name": "ADMIN AGENT"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b8d547ae-1d75-4885-ae8f-9c8d1ba18ef1",
              "name": "output",
              "value": "={{ $json.output.parseJson() }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        896,
        832
      ],
      "id": "95311097-6222-4a1f-be30-1f5a361ed2ff",
      "name": "Edit Fields",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const raw = items[0].json.output;\n\nif (!raw) {\n  return { json: { error: \"No output received\" } };\n}\n\nif (typeof raw === 'object' && raw !== null) {\n    return {\n        json: {\n            output: raw\n        }\n    };\n}\n\nlet braceCount = 0;\nlet startIndex = raw.indexOf('{');\nlet endIndex = -1;\n\nif (startIndex === -1) {\n   return { json: { error: \"No JSON found\" } };\n}\n\nfor (let i = startIndex; i < raw.length; i++) {\n    if (raw[i] === '{') {\n        braceCount++;\n    } else if (raw[i] === '}') {\n        braceCount--;\n\n        if (braceCount === 0) {\n            endIndex = i;\n            break; \n        }\n    }\n}\n\nif (endIndex !== -1) {\n    const cleanJsonString = raw.substring(startIndex, endIndex + 1);\n    try {\n        const parsedObject = JSON.parse(cleanJsonString);\n        return {\n            json: {\n                output: parsedObject\n            }\n        };\n    } catch (e) {\n        throw new Error(\"Error parseando el JSON limpio: \" + e.message);\n    }\n} else {\n    throw new Error(\"No se pudo encontrar un objeto JSON completo en la respuesta.\");\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        832
      ],
      "id": "89105111-0ae0-429a-a519-9a0e573b0be2",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.telegram_user }}",
        "contextWindowLength": 7
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        560,
        1056
      ],
      "id": "e3271d05-44a6-4dfd-b951-55c8371c84a9",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "a8c2d1ad-2fd2-47df-a8fe-9b079de68222",
              "leftValue": "={{ $json.output.data.next_step.toLowerCase() }}",
              "rightValue": "=post_action",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "12450f89-b4e6-4792-8c06-93b13bdd2625",
              "leftValue": "={{ $('Code in JavaScript').item.json.output.input }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "72938d94-0d75-4720-8319-b4d995458958",
              "leftValue": "={{ $('Code in JavaScript').item.json.output.paso_actual }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2144,
        832
      ],
      "id": "750bef4a-40ad-4a53-98d1-d49f55e72476",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "45b5d41b-2aaf-4dd7-8c8d-36497d035759",
              "name": "output",
              "value": "={{ $('Code in JavaScript2').item.json.output }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2368,
        928
      ],
      "id": "255ff529-505c-4eee-9bc5-4a7bb0d1dedb",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "45b5d41b-2aaf-4dd7-8c8d-36497d035759",
              "name": "datos",
              "value": "={{ $('Code in JavaScript').item.json.output.datos_parciales }}",
              "type": "object"
            },
            {
              "id": "2c1278a7-e398-45b5-9a1f-086262d3fa07",
              "name": "telegram_user",
              "value": "={{ $('Start').item.json.telegram_user }}",
              "type": "string"
            },
            {
              "id": "0e8c7c2d-4b30-4d57-8cb3-0f5ef5ed83f0",
              "name": "items",
              "value": "={{ $('Code in JavaScript').item.json.output.datos_parciales.parseJson().items.replaceAll(\" \", \"\").split(\",\") }}",
              "type": "array"
            },
            {
              "id": "32b1bf20-b9c1-4543-9b14-b0e416bd597d",
              "name": "id_lista",
              "value": "=LISTA-{{ $now.format('x') }}",
              "type": "string"
            },
            {
              "id": "b43d03d4-aa88-42b6-ad5a-a23808831691",
              "name": "output",
              "value": "={{ $json.output }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2368,
        736
      ],
      "id": "c804b92d-166a-40dc-8523-91095473f41b",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "fieldToSplitOut": "items",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2592,
        640
      ],
      "id": "c73b42c8-4a68-4940-90a9-66f977d898bc",
      "name": "Split Out"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2816,
        640
      ],
      "id": "e8940aff-c133-4b15-9f9e-308fa37e5dd6",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U",
          "mode": "list",
          "cachedResultName": "n8n_proyecto",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1861730297,
          "mode": "list",
          "cachedResultName": "ITEMS_LISTA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit#gid=1861730297"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_item": "=ITEM-{{ $now.format('x') }}",
            "id_lista": "={{ $('Edit Fields3').item.json.id_lista }}",
            "item": "={{ $json.items }}",
            "estado": "PENDIENTE"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_item",
              "displayName": "id_item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "item",
              "displayName": "item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3040,
        640
      ],
      "id": "238be7a0-9cb8-4527-a876-29357d81c343",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "DlZYHrjKDTxHghoa",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U",
          "mode": "list",
          "cachedResultName": "n8n_proyecto",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 823328797,
          "mode": "list",
          "cachedResultName": "LISTAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1kULA8R52h-BNE1vC09og0Yl8PKV3nUFJ2OUfD561S3U/edit#gid=823328797"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_lista": "={{ $json.id_lista }}",
            "nombre_lista": "={{ $json.datos.nombre_lista }}",
            "tipo": "={{ $json.datos.tipo_lista }}",
            "creado_por": "={{ $json.telegram_user }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_lista",
              "displayName": "id_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre_lista",
              "displayName": "nombre_lista",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo",
              "displayName": "tipo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2592,
        832
      ],
      "id": "1fc3b668-e668-4f11-b7fe-5707fe9b6766",
      "name": "Append row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "DlZYHrjKDTxHghoa",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c4facc5c-e1e9-4517-9147-f7936760d64d",
              "name": "output",
              "value": "={{ $('Edit Fields3').item.json.output }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2816,
        832
      ],
      "id": "f98fbde2-396e-4ec0-96e4-9cc7d9004de4",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1360,
        1056
      ],
      "id": "b136ed7b-ce31-468e-9247-b2e54de6e971",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "Uraezaqnm4BlWCgn",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        432,
        1056
      ],
      "id": "1ad816ab-2e0c-40ef-8286-458bbec7063e",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "Uraezaqnm4BlWCgn",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "MEMORIA ADMIN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "ADMIN AGENT",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtain Session Info": {
      "ai_tool": [
        [
          {
            "node": "MEMORIA ADMIN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MEMORIA ADMIN": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ADMIN AGENT": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "ADMIN AGENT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "MEMORIA ADMIN",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          },
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ADMIN AGENT",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "MEMORIA ADMIN",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4e7f61551d974e9201959bc61f3fe1ba29fb38be1f22e798be449222f24c742f"
  }
}